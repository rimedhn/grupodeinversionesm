<!doctype html>
<html lang="es">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Pr√©stamos</title>
  <link rel="icon" href="https://github.com/rimedhn/calculadora-de-prestamos/blob/main/Logo%20Demo%20Finan.png?raw=true">
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
            color: #333;
        }

        html, body {
            height: 100%;
        }

        .navbar {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        .business-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 2rem;
        }

        .steps-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            position: relative;
        }

        .step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e0e0;
            color: #999;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
            font-weight: bold;
            transition: all 0.3s;
        }

        .step.active .step-number {
            background: #667eea;
            color: white;
        }

        .step.completed .step-number {
            background: #4caf50;
            color: white;
        }

        .step-label {
            font-size: 0.9rem;
            color: #666;
        }

        .step.active .step-label {
            color: #667eea;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #555;
        }

        input, select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-section {
            display: none;
            margin-top: 2rem;
        }

        .result-section.active {
            display: block;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .summary-item {
            background: #f5f5f5;
            padding: 1rem;
            border-radius: 8px;
        }

        .summary-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.25rem;
        }

        .summary-value {
            font-size: 1.25rem;
            font-weight: bold;
            color: #667eea;
        }

        .payment-schedule {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f5f5f5;
            font-weight: 600;
            color: #555;
        }

        tr:hover {
            background: #f9f9f9;
        }

        .footer {
            background: white;
            padding: 2rem;
            margin-top: 3rem;
            text-align: center;
        }

        .footer-content {
            max-width: 900px;
            margin: 0 auto;
        }

        .footer-info {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .footer-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .social-link {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: all 0.3s;
        }

        .social-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .credits {
            font-size: 0.9rem;
            color: #666;
            padding-top: 1rem;
            border-top: 1px solid #e0e0e0;
        }

        .whatsapp-float {
            position: fixed;
            width: 60px;
            height: 60px;
            bottom: 30px;
            right: 30px;
            background: #25d366;
            color: white;
            border-radius: 50%;
            text-align: center;
            font-size: 30px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.3);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: all 0.3s;
        }

        .whatsapp-float:hover {
            transform: scale(1.1);
            box-shadow: 2px 2px 20px rgba(37, 211, 102, 0.5);
        }

        .print-float {
            position: fixed;
            width: 60px;
            height: 60px;
            bottom: 100px;
            right: 30px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            text-align: center;
            font-size: 30px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.3);
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .print-float:hover {
            transform: scale(1.1);
            box-shadow: 2px 2px 20px rgba(102, 126, 234, 0.5);
        }

        .print-float.active {
            display: flex;
        }

        .print-section {
            display: none;
        }

        .summary-table {
            display: none;
        }

        .info-table {
            display: none;
        }

        .client-info-table {
            display: none;
        }

        .manager-info-table {
            display: none;
        }

        .print-hide {
            display: none !important;
        }

        @media print {
            body {
                background: white !important;
                margin: 0;
                padding: 0;
            }

            .navbar, .footer, .whatsapp-float, .print-float, .button-group, .steps-indicator {
                display: none !important;
            }

            .step-content {
                display: none !important;
            }

            .card:not(.result-section .card) {
                display: none !important;
            }

            .result-section {
                display: block !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            .container {
                max-width: 100%;
                margin: 0 auto;
                padding: 1cm;
            }

            .card {
                box-shadow: none;
                page-break-inside: avoid;
                padding: 0;
                margin: 0;
                border-radius: 0;
            }

            .print-section {
                display: block !important;
            }

            .print-hide {
                display: none !important;
            }

            .print-header {
                margin-bottom: 1.5rem;
                padding-bottom: 1rem;
                border-bottom: 2px solid #667eea;
            }

            .print-header h1 {
                font-size: 1.8rem;
                margin-bottom: 0.5rem;
                color: #667eea;
            }

            .print-date {
                font-size: 0.9rem;
                color: #666;
            }

            h2 {
                font-size: 1.3rem;
                margin-bottom: 0.8rem !important;
                margin-top: 1.5rem !important;
                color: #667eea;
            }

            h3 {
                font-size: 1.1rem;
                margin-bottom: 0.8rem !important;
                margin-top: 1.2rem !important;
                color: #667eea;
            }

            .info-section {
                display: none !important;
            }

            .info-table {
                display: table !important;
                width: 100%;
                border-collapse: collapse;
            }

            .info-table td {
                padding: 0.5rem;
                font-size: 0.9rem;
                border: none;
            }

            .info-table .label-cell {
                font-weight: 600;
                background: #f5f5f5;
                width: 40%;
            }

            .client-info-table {
                display: table !important;
            }

            .manager-info-table {
                display: table !important;
            }

            .summary-grid {
                display: none !important;
            }

            .summary-table {
                display: table !important;
                width: 100%;
                margin-bottom: 1rem;
                border-collapse: collapse;
            }

            .summary-table td {
                padding: 0.5rem;
                font-size: 0.9rem;
                border: none;
            }

            .summary-table .label-cell {
                font-weight: 600;
                background: #f5f5f5;
                width: 25%;
            }

            .payment-schedule {
                overflow-x: visible;
            }

            table {
                page-break-inside: auto;
                font-size: 0.85rem;
                border-collapse: collapse;
                width: 100%;
            }

            th, td {
                padding: 0.5rem;
                border: 1px solid #ddd;
            }

            th {
                font-size: 0.85rem;
                background: #f5f5f5;
                font-weight: 600;
            }

            tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }

            tbody tr:nth-child(even) {
                background: #fafafa;
            }
        }

        .print-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #667eea;
        }

        .print-header h1 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .print-date {
            color: #666;
            font-size: 0.9rem;
        }

        .info-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .info-box {
            border: 1px solid #e0e0e0;
            padding: 1rem;
            border-radius: 8px;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .info-label {
            color: #666;
        }

        .info-value {
            font-weight: 600;
        }

        .hidden {
            display: none;
        }

        .signature-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid #e0e0e0;
        }

        .signature-box {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }

        .signature-line {
            border-bottom: 2px solid #333;
            margin-bottom: 0.5rem;
            height: 60px;
        }

        .signature-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.25rem;
        }

        .signature-label {
            font-size: 0.9rem;
            color: #666;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            max-width: 700px;
            width: 90%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e0e0e0;
        }

        .modal-header h2 {
            color: #667eea;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: #f0f0f0;
            color: #333;
        }

        .config-section {
            margin-bottom: 2rem;
        }

        .config-section h3 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 0.75rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 5px;
            transition: background 0.2s;
        }

        .checkbox-item:hover {
            background: #f5f5f5;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-item label {
            cursor: pointer;
            margin: 0;
            font-weight: 500;
        }

        @media print {
            .signature-section {
                page-break-inside: avoid;
                margin-top: 2rem;
            }

            .modal-overlay {
                display: none !important;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .container {
                padding: 0 0.5rem;
            }

            .card {
                padding: 1rem;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }

            .info-section {
                grid-template-columns: 1fr;
            }

            .footer-info {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <nav class="navbar">
   <div class="logo-section"><img src="https://github.com/rimedhn/calculadora-de-prestamos/blob/main/Logo%20Demo%20Finan.png?raw=true" alt="Logo del Negocio" class="logo" onerror="this.style.display='none';">
    <div class="business-name" id="navBusinessName">
     GRUPO DE INVERSIONES M√öLTIPLES
    </div>
   </div>
  </nav>
  <div class="container">
   <div class="card">
    <div class="steps-indicator">
     <div class="step active" data-step="1">
      <div class="step-number">
       1
      </div>
      <div class="step-label">
       Datos del Cliente
      </div>
     </div>
     <div class="step" data-step="2">
      <div class="step-number">
       2
      </div>
      <div class="step-label">
       Datos del Pr√©stamo
      </div>
     </div>
     <div class="step" data-step="3">
      <div class="step-number">
       3
      </div>
      <div class="step-label">
       Datos del Gestor
      </div>
     </div>
    </div>
    <div style="margin-bottom: 1.5rem;"><button class="btn btn-secondary" onclick="openPrintSettings()" style="width: 100%;"> ‚öôÔ∏è Configurar Reporte PDF </button>
    </div>
    <div class="step-content active" id="step1">
     <h2 style="margin-bottom: 1.5rem; color: #667eea;">Paso 1: Datos del Cliente</h2>
     <div class="form-group"><label for="clientName">Nombre Completo</label> <input type="text" id="clientName" placeholder="Ingrese nombre completo">
     </div>
     <div class="form-group"><label for="clientPhone">Tel√©fono</label> <input type="tel" id="clientPhone" placeholder="+504 0000-0000">
     </div>
     <div class="form-group"><label for="clientAddress">Direcci√≥n</label> <input type="text" id="clientAddress" placeholder="Ingrese direcci√≥n completa">
     </div>
     <div class="button-group"><button class="btn btn-primary" onclick="nextStep(2)">Siguiente</button>
     </div>
    </div>
    <div class="step-content" id="step2">
     <h2 style="margin-bottom: 1.5rem; color: #667eea;">Paso 2: Datos del Pr√©stamo</h2>
     <div class="form-group"><label for="loanType">Tipo de Pr√©stamo *</label> <select id="loanType" onchange="handleLoanTypeChange()"> <option value="amortizado">Amortizado (Cuotas Niveladas)</option> <option value="abierto">Abierto (Pago Flexible)</option> </select>
     </div>
     <div class="form-group"><label for="interestType">Tipo de Inter√©s *</label> <select id="interestType"> <option value="simple">Simple</option> <option value="redescontado">Redescontado</option> </select>
     </div>
     <div class="form-group"><label for="rateType">Tipo de Tasa *</label> <select id="rateType"> <option value="diaria">Diaria</option> <option value="semanal">Semanal</option> <option value="quincenal">Quincenal</option> <option value="mensual">Mensual</option> <option value="anual">Anual</option> </select>
     </div>
     <div class="form-group"><label for="loanAmount">Monto del Pr√©stamo *</label> <input type="number" id="loanAmount" required placeholder="0.00" step="0.01" min="0">
     </div>
     <div class="form-group"><label for="interestRate">Tasa de Inter√©s (%) *</label> <input type="number" id="interestRate" required placeholder="0.00" step="0.01" min="0">
     </div>
     <div class="form-group"><label for="downPayment">Prima / Enganche</label> <input type="number" id="downPayment" placeholder="0.00" step="0.01" min="0" value="0">
     </div>
     <div class="form-group"><label for="numberOfPayments">Cantidad de Pagos *</label> <input type="number" id="numberOfPayments" required placeholder="12" min="1" step="1">
     </div>
     <div class="button-group"><button class="btn btn-secondary" onclick="previousStep(1)">Anterior</button> <button class="btn btn-primary" onclick="nextStep(3)">Siguiente</button>
     </div>
    </div>
    <div class="step-content" id="step3">
     <h2 style="margin-bottom: 1.5rem; color: #667eea;">Paso 3: Datos del Gestor</h2>
     <div class="form-group"><label for="managerName">Nombre del Gestor</label> <input type="text" id="managerName" placeholder="Ingrese nombre del gestor">
     </div>
     <div class="form-group"><label for="managerPhone">Tel√©fono del Gestor</label> <input type="tel" id="managerPhone" placeholder="+504 0000-0000">
     </div>
     <div class="button-group"><button class="btn btn-secondary" onclick="previousStep(2)">Anterior</button> <button class="btn btn-success" onclick="calculateLoan()">Calcular Pr√©stamo</button>
     </div>
    </div>
   </div>
   <div class="result-section" id="resultSection">
    <div class="card">
     <div class="print-section print-header" id="printHeaderSection">
      <div style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 0.5rem;"><img id="printLogo" src="https://github.com/rimedhn/calculadora-de-prestamos/blob/main/Logo%20Demo%20Finan.png?raw=true" alt="Logo del Negocio" style="width: 50px; height: 50px; object-fit: contain;" onerror="this.style.display='none';">
       <h1 id="printBusinessName" style="margin: 0;">Nombre del Negocio</h1>
      </div>
      <div style="text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 0.5rem;">
       <div id="printBusinessAddress"></div>
       <div id="printBusinessContact"></div>
      </div>
      <div class="print-date" id="printDate"></div>
     </div>
     <h2 style="margin-bottom: 1.5rem; color: #667eea;">Resumen del Pr√©stamo</h2>
     <div class="info-section" id="infoSection">
      <div class="info-box" id="clientInfoBox">
       <h3>Informaci√≥n del Cliente</h3>
       <div class="info-row" id="clientNameRow"><span class="info-label">Nombre:</span> <span class="info-value" id="resultClientName"></span>
       </div>
       <div class="info-row" id="clientPhoneRow"><span class="info-label">Tel√©fono:</span> <span class="info-value" id="resultClientPhone"></span>
       </div>
       <div class="info-row" id="clientAddressRow"><span class="info-label">Direcci√≥n:</span> <span class="info-value" id="resultClientAddress"></span>
       </div>
      </div>
      <div class="info-box" id="managerInfoBox">
       <h3>Informaci√≥n del Gestor</h3>
       <div class="info-row" id="managerNameRow"><span class="info-label">Nombre:</span> <span class="info-value" id="resultManagerName"></span>
       </div>
       <div class="info-row" id="managerPhoneRow"><span class="info-label">Tel√©fono:</span> <span class="info-value" id="resultManagerPhone"></span>
       </div>
      </div>
     </div>
     <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
      <table class="info-table client-info-table" id="clientInfoTablePrint">
       <tbody>
        <tr id="clientNameRowTable">
         <td class="label-cell">Cliente</td>
         <td id="resultClientNameTable"></td>
        </tr>
        <tr id="clientPhoneRowTable">
         <td class="label-cell">Tel√©fono</td>
         <td id="resultClientPhoneTable"></td>
        </tr>
        <tr id="clientAddressRowTable">
         <td class="label-cell">Direcci√≥n</td>
         <td id="resultClientAddressTable"></td>
        </tr>
       </tbody>
      </table>
      <table class="info-table manager-info-table" id="managerInfoTablePrint">
       <tbody>
        <tr id="managerNameRowTable">
         <td class="label-cell">Gestor</td>
         <td id="resultManagerNameTable"></td>
        </tr>
        <tr id="managerPhoneRowTable">
         <td class="label-cell">Tel√©fono</td>
         <td id="resultManagerPhoneTable"></td>
        </tr>
       </tbody>
      </table>
     </div>
     <div class="summary-grid">
      <div class="summary-item" id="summaryLoanType">
       <div class="summary-label">
        Tipo de Pr√©stamo
       </div>
       <div class="summary-value" id="resultLoanType"></div>
      </div>
      <div class="summary-item" id="summaryLoanAmount">
       <div class="summary-label">
        Monto Solicitado
       </div>
       <div class="summary-value" id="resultLoanAmount"></div>
      </div>
      <div class="summary-item" id="summaryDownPayment">
       <div class="summary-label">
        Prima
       </div>
       <div class="summary-value" id="resultDownPayment"></div>
      </div>
      <div class="summary-item" id="summaryFinancedAmount">
       <div class="summary-label">
        Monto a Financiar
       </div>
       <div class="summary-value" id="resultFinancedAmount"></div>
      </div>
      <div class="summary-item" id="summaryInterestRate">
       <div class="summary-label">
        Tasa de Inter√©s
       </div>
       <div class="summary-value" id="resultInterestRate"></div>
      </div>
      <div class="summary-item" id="summaryTotalInterest">
       <div class="summary-label">
        Total de Intereses
       </div>
       <div class="summary-value" id="resultTotalInterest"></div>
      </div>
      <div class="summary-item" id="summaryTotalAmount">
       <div class="summary-label">
        Total a Pagar
       </div>
       <div class="summary-value" id="resultTotalAmount"></div>
      </div>
      <div class="summary-item" id="monthlyPaymentItem">
       <div class="summary-label">
        Cuota
       </div>
       <div class="summary-value" id="resultMonthlyPayment"></div>
      </div>
     </div>
     <table class="summary-table">
      <tbody>
       <tr>
        <td class="label-cell">Tipo de Pr√©stamo</td>
        <td id="resultLoanTypeTable"></td>
        <td class="label-cell">Monto Solicitado</td>
        <td id="resultLoanAmountTable"></td>
       </tr>
       <tr>
        <td class="label-cell">Prima</td>
        <td id="resultDownPaymentTable"></td>
        <td class="label-cell">Monto a Financiar</td>
        <td id="resultFinancedAmountTable"></td>
       </tr>
       <tr>
        <td class="label-cell">Tasa de Inter√©s</td>
        <td id="resultInterestRateTable"></td>
        <td class="label-cell" id="monthlyPaymentLabelTable">Cuota</td>
        <td id="resultMonthlyPaymentTable"></td>
       </tr>
       <tr>
        <td class="label-cell">Total de Intereses</td>
        <td id="resultTotalInterestTable"></td>
        <td class="label-cell">Total a Pagar</td>
        <td id="resultTotalAmountTable"></td>
       </tr>
      </tbody>
     </table>
     <h3 style="margin-top: 2rem; margin-bottom: 1rem; color: #667eea;">Plan de Pagos Proyectado</h3>
     <div class="payment-schedule">
      <table id="paymentTable">
       <thead>
        <tr>
         <th>No.</th>
         <th>Fecha</th>
         <th>Saldo Inicial</th>
         <th>Cuota</th>
         <th>Capital</th>
         <th>Inter√©s</th>
         <th>Saldo Final</th>
        </tr>
       </thead>
       <tbody id="paymentTableBody">
       </tbody>
      </table>
     </div>
     <div class="signature-section">
      <div class="signature-box">
       <div class="signature-line"></div>
       <div class="signature-name" id="signatureName"></div>
       <div class="signature-label">
        Firma del Cliente
       </div>
      </div>
     </div>
     <div class="button-group"><button class="btn btn-secondary" onclick="resetCalculator()">Nuevo C√°lculo</button> <button class="btn btn-primary" onclick="window.print()">Imprimir Reporte</button>
     </div>
    </div>
   </div>
  </div>
  <footer class="footer">
   <div class="footer-content">
    <div class="footer-info">
     <div class="footer-item"><span>üìû</span> <span id="footerPhone">9359-3126</span>
     </div>
     <div class="footer-item"><span>üìß</span> <span id="footerEmail">indime.hn@gmail.com</span>
     </div>
     <div class="footer-item"><span>üìç</span> <span id="footerAddress">La Ceiba, Atlantida</span>
     </div>
    </div>
    <div class="social-links" id="socialLinks"></div>
    <div class="credits">
     Desarrollado por <strong>Rimed Digital</strong><br>
      üìß gerencia@rimeddigital.com | üìû +504 9359-3126
    </div>
   </div>
  </footer><button class="print-float" id="printFloat" onclick="window.print()"> üñ®Ô∏è </button> <a href="#" class="whatsapp-float" id="whatsappFloat" target="_blank" rel="noopener noreferrer">
   <svg viewbox="0 0 32 32" width="32" height="32" fill="white"><path d="M16 0c-8.837 0-16 7.163-16 16 0 2.825 0.737 5.607 2.137 8.048l-2.137 7.952 7.933-2.127c2.42 1.37 5.173 2.127 8.067 2.127 8.837 0 16-7.163 16-16s-7.163-16-16-16zM16 29.467c-2.482 0-4.908-0.646-7.07-1.87l-0.507-0.292-5.247 1.408 1.408-5.227-0.323-0.53c-1.33-2.166-2.028-4.671-2.028-7.256 0-7.636 6.213-13.85 13.85-13.85s13.85 6.213 13.85 13.85c0 7.636-6.213 13.85-13.85 13.85zM23.401 19.892c-0.398-0.201-2.348-1.158-2.713-1.291-0.365-0.133-0.63-0.199-0.896 0.199s-1.029 1.291-1.261 1.557c-0.232 0.265-0.464 0.298-0.862 0.097-0.398-0.199-1.68-0.619-3.199-1.976-1.182-1.054-1.981-2.356-2.213-2.754s-0.025-0.613 0.175-0.812c0.179-0.179 0.398-0.464 0.597-0.696 0.199-0.232 0.265-0.398 0.398-0.663 0.133-0.265 0.066-0.497-0.033-0.696s-0.896-2.159-1.228-2.956c-0.323-0.776-0.652-0.671-0.896-0.684-0.232-0.012-0.497-0.015-0.762-0.015s-0.696 0.099-1.061 0.497c-0.365 0.398-1.394 1.361-1.394 3.319s1.427 3.852 1.627 4.117c0.199 0.265 2.807 4.283 6.802 6.008 0.95 0.411 1.691 0.656 2.269 0.839 0.955 0.303 1.824 0.26 2.512 0.158 0.766-0.115 2.348-0.96 2.679-1.887s0.331-1.723 0.232-1.887c-0.099-0.165-0.365-0.265-0.762-0.464z" />
   </svg></a> <!-- Modal de Configuraci√≥n -->
  <div class="modal-overlay" id="printSettingsModal">
   <div class="modal-content">
    <div class="modal-header">
     <h2>‚öôÔ∏è Configuraci√≥n del Reporte PDF</h2><button class="close-btn" onclick="closePrintSettings()">√ó</button>
    </div>
    <div class="config-section">
     <h3>üìã Informaci√≥n del Negocio</h3>
     <div class="checkbox-group">
      <div class="checkbox-item"><input type="checkbox" id="check_logo" onchange="updatePrintConfig('show_logo', this.checked)"> <label for="check_logo">Mostrar Logo</label>
      </div>
      <div class="checkbox-item"><input type="checkbox" id="check_business_name" onchange="updatePrintConfig('show_business_name', this.checked)"> <label for="check_business_name">Mostrar Nombre del Negocio</label>
      </div>
      <div class="checkbox-item"><input type="checkbox" id="check_business_address" onchange="updatePrintConfig('show_business_address', this.checked)"> <label for="check_business_address">Mostrar Direcci√≥n</label>
      </div>
      <div class="checkbox-item"><input type="checkbox" id="check_business_phone" onchange="updatePrintConfig('show_business_phone', this.checked)"> <label for="check_business_phone">Mostrar Tel√©fono</label>
      </div>
      <div class="checkbox-item"><input type="checkbox" id="check_business_email" onchange="updatePrintConfig('show_business_email', this.checked)"> <label for="check_business_email">Mostrar Email</label>
      </div>
     </div>
    </div>
    <div class="config-section">
     <h3>üë§ Informaci√≥n del Cliente</h3>
     <div class="checkbox-group">
      <div class="checkbox-item"><input type="checkbox" id="check_client_name" onchange="updatePrintConfig('show_client_name', this.checked)"> <label for="check_client_name">Mostrar Nombre</label>
      </div>
      <div class="checkbox-item"><input type="checkbox" id="check_client_phone" onchange="updatePrintConfig('show_client_phone', this.checked)"> <label for="check_client_phone">Mostrar Tel√©fono</label>
      </div>
      <div class="checkbox-item"><input type="checkbox" id="check_client_address" onchange="updatePrintConfig('show_client_address', this.checked)"> <label for="check_client_address">Mostrar Direcci√≥n</label>
      </div>
     </div>
    </div>
    <div class="config-section">
     <h3>üßë‚Äçüíº Informaci√≥n del Gestor</h3>
     <div class="checkbox-group">
      <div class="checkbox-item"><input type="checkbox" id="check_manager_name" onchange="updatePrintConfig('show_manager_name', this.checked)"> <label for="check_manager_name">Mostrar Nombre</label>
      </div>
      <div class="checkbox-item"><input type="checkbox" id="check_manager_phone" onchange="updatePrintConfig('show_manager_phone', this.checked)"> <label for="check_manager_phone">Mostrar Tel√©fono</label>
      </div>
     </div>
    </div>
    <div class="config-section">
     <h3>üí∞ Datos del Pr√©stamo</h3>
     <div class="checkbox-group">
      <div class="checkbox-item"><input type="checkbox" id="check_loan_type" onchange="updatePrintConfig('show_loan_type', this.checked)"> <label for="check_loan_type">Tipo de Pr√©stamo</label>
      </div>
      <div class="checkbox-item"><input type="checkbox" id="check_loan_amount" onchange="updatePrintConfig('show_loan_amount', this.checked)"> <label for="check_loan_amount">Monto Solicitado</label>
      </div>
      <div class="checkbox-item"><input type="checkbox" id="check_down_payment" onchange="updatePrintConfig('show_down_payment', this.checked)"> <label for="check_down_payment">Prima/Enganche</label>
      </div>
      <div class="checkbox-item"><input type="checkbox" id="check_financed_amount" onchange="updatePrintConfig('show_financed_amount', this.checked)"> <label for="check_financed_amount">Monto a Financiar</label>
      </div>
      <div class="checkbox-item"><input type="checkbox" id="check_interest_rate" onchange="updatePrintConfig('show_interest_rate', this.checked)"> <label for="check_interest_rate">Tasa de Inter√©s</label>
      </div>
      <div class="checkbox-item"><input type="checkbox" id="check_monthly_payment" onchange="updatePrintConfig('show_monthly_payment', this.checked)"> <label for="check_monthly_payment">Cuota Mensual</label>
      </div>
      <div class="checkbox-item"><input type="checkbox" id="check_total_interest" onchange="updatePrintConfig('show_total_interest', this.checked)"> <label for="check_total_interest">Total de Intereses</label>
      </div>
      <div class="checkbox-item"><input type="checkbox" id="check_total_amount" onchange="updatePrintConfig('show_total_amount', this.checked)"> <label for="check_total_amount">Total a Pagar</label>
      </div>
     </div>
    </div>
    <div class="config-section">
     <h3>üìä Tabla y Firma</h3>
     <div class="checkbox-group">
      <div class="checkbox-item"><input type="checkbox" id="check_payment_schedule" onchange="updatePrintConfig('show_payment_schedule', this.checked)"> <label for="check_payment_schedule">Tabla de Amortizaci√≥n</label>
      </div>
      <div class="checkbox-item"><input type="checkbox" id="check_signature" onchange="updatePrintConfig('show_signature', this.checked)"> <label for="check_signature">Secci√≥n de Firma</label>
      </div>
     </div>
    </div>
    <div class="button-group"><button class="btn btn-success" onclick="closePrintSettings()">Guardar Configuraci√≥n</button>
    </div>
   </div>
  </div>
  <script>
        const defaultConfig = {
            business_name: "GRUPO DE INVERSIONES MULTIPLES",
            business_phone: "9359-3126",
            business_email: "gim@correo.com",
            business_address: "LA CEIBA",
            whatsapp_number: "+50493593126",
            facebook_url: "",
            instagram_url: "",
            twitter_url: ""
        };

        // Configuraci√≥n de visualizaci√≥n (qu√© mostrar en el PDF)
        let printConfig = {
            show_logo: true,
            show_business_name: true,
            show_business_address: true,
            show_business_phone: true,
            show_business_email: true,
            show_client_name: true,
            show_client_phone: true,
            show_client_address: true,
            show_manager_name: true,
            show_manager_phone: true,
            show_loan_type: true,
            show_loan_amount: true,
            show_down_payment: true,
            show_financed_amount: true,
            show_interest_rate: true,
            show_monthly_payment: true,
            show_total_interest: true,
            show_total_amount: true,
            show_payment_schedule: true,
            show_signature: true
        };

        // Cargar configuraci√≥n guardada
        function loadPrintConfig() {
            const saved = localStorage.getItem('printConfig');
            if (saved) {
                printConfig = { ...printConfig, ...JSON.parse(saved) };
            }
        }

        // Guardar configuraci√≥n
        function savePrintConfig() {
            localStorage.setItem('printConfig', JSON.stringify(printConfig));
        }

        loadPrintConfig();

        let currentStep = 1;
        let loanData = {};

        // Funciones del modal
        function openPrintSettings() {
            loadCheckboxStates();
            document.getElementById('printSettingsModal').classList.add('active');
        }

        function closePrintSettings() {
            document.getElementById('printSettingsModal').classList.remove('active');
        }

        // Cerrar modal al hacer clic en el overlay
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('printSettingsModal');
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closePrintSettings();
                }
            });
        });

        function updatePrintConfig(key, value) {
            printConfig[key] = value;
            savePrintConfig();
            applyPrintConfig();
        }

        function loadCheckboxStates() {
            document.getElementById('check_logo').checked = printConfig.show_logo;
            document.getElementById('check_business_name').checked = printConfig.show_business_name;
            document.getElementById('check_business_address').checked = printConfig.show_business_address;
            document.getElementById('check_business_phone').checked = printConfig.show_business_phone;
            document.getElementById('check_business_email').checked = printConfig.show_business_email;
            document.getElementById('check_client_name').checked = printConfig.show_client_name;
            document.getElementById('check_client_phone').checked = printConfig.show_client_phone;
            document.getElementById('check_client_address').checked = printConfig.show_client_address;
            document.getElementById('check_manager_name').checked = printConfig.show_manager_name;
            document.getElementById('check_manager_phone').checked = printConfig.show_manager_phone;
            document.getElementById('check_loan_type').checked = printConfig.show_loan_type;
            document.getElementById('check_loan_amount').checked = printConfig.show_loan_amount;
            document.getElementById('check_down_payment').checked = printConfig.show_down_payment;
            document.getElementById('check_financed_amount').checked = printConfig.show_financed_amount;
            document.getElementById('check_interest_rate').checked = printConfig.show_interest_rate;
            document.getElementById('check_monthly_payment').checked = printConfig.show_monthly_payment;
            document.getElementById('check_total_interest').checked = printConfig.show_total_interest;
            document.getElementById('check_total_amount').checked = printConfig.show_total_amount;
            document.getElementById('check_payment_schedule').checked = printConfig.show_payment_schedule;
            document.getElementById('check_signature').checked = printConfig.show_signature;
        }

        function applyPrintConfig() {
            // Las configuraciones SOLO afectan el PDF, NO el sitio web
            // Solo trabajamos con elementos que tienen clases espec√≠ficas para impresi√≥n
            
            // Encabezado del negocio (solo en impresi√≥n)
            const printHeaderSection = document.getElementById('printHeaderSection');
            if (printHeaderSection) {
                if (!printConfig.show_logo && !printConfig.show_business_name && 
                    !printConfig.show_business_address && !printConfig.show_business_phone && !printConfig.show_business_email) {
                    printHeaderSection.classList.add('print-hide');
                } else {
                    printHeaderSection.classList.remove('print-hide');
                }
            }

            const printLogo = document.getElementById('printLogo');
            if (printLogo) {
                if (!printConfig.show_logo) {
                    printLogo.classList.add('print-hide');
                } else {
                    printLogo.classList.remove('print-hide');
                }
            }

            const printBusinessName = document.getElementById('printBusinessName');
            if (printBusinessName) {
                if (!printConfig.show_business_name) {
                    printBusinessName.classList.add('print-hide');
                } else {
                    printBusinessName.classList.remove('print-hide');
                }
            }

            const printBusinessAddress = document.getElementById('printBusinessAddress');
            if (printBusinessAddress) {
                if (!printConfig.show_business_address) {
                    printBusinessAddress.classList.add('print-hide');
                } else {
                    printBusinessAddress.classList.remove('print-hide');
                }
            }

            const printBusinessContact = document.getElementById('printBusinessContact');
            if (printBusinessContact) {
                if (!printConfig.show_business_phone && !printConfig.show_business_email) {
                    printBusinessContact.classList.add('print-hide');
                } else {
                    printBusinessContact.classList.remove('print-hide');
                }
            }

            // Tabla de pagos
            const paymentScheduleSection = document.querySelector('.payment-schedule');
            if (paymentScheduleSection) {
                const scheduleTitle = paymentScheduleSection.previousElementSibling;
                if (!printConfig.show_payment_schedule) {
                    paymentScheduleSection.classList.add('print-hide');
                    if (scheduleTitle && scheduleTitle.tagName === 'H3') {
                        scheduleTitle.classList.add('print-hide');
                    }
                } else {
                    paymentScheduleSection.classList.remove('print-hide');
                    if (scheduleTitle && scheduleTitle.tagName === 'H3') {
                        scheduleTitle.classList.remove('print-hide');
                    }
                }
            }

            // Secci√≥n de firma
            const signatureSection = document.querySelector('.signature-section');
            if (signatureSection) {
                if (!printConfig.show_signature) {
                    signatureSection.classList.add('print-hide');
                } else {
                    signatureSection.classList.remove('print-hide');
                }
            }

            // Aplicar configuraci√≥n a las tablas de impresi√≥n
            applyInfoTableVisibility();
            applySummaryTableVisibility();
        }

        function applyInfoTableVisibility() {
            const clientInfoTablePrint = document.getElementById('clientInfoTablePrint');
            const managerInfoTablePrint = document.getElementById('managerInfoTablePrint');
            
            // Tabla de informaci√≥n del cliente
            if (clientInfoTablePrint) {
                const clientNameRow = document.getElementById('clientNameRowTable');
                const clientPhoneRow = document.getElementById('clientPhoneRowTable');
                const clientAddressRow = document.getElementById('clientAddressRowTable');
                
                // Aplicar configuraci√≥n de visibilidad
                if (!printConfig.show_client_name && clientNameRow) {
                    clientNameRow.classList.add('print-hide');
                } else if (clientNameRow) {
                    clientNameRow.classList.remove('print-hide');
                }
                
                if (!printConfig.show_client_phone && clientPhoneRow) {
                    clientPhoneRow.classList.add('print-hide');
                } else if (clientPhoneRow) {
                    clientPhoneRow.classList.remove('print-hide');
                }
                
                if (!printConfig.show_client_address && clientAddressRow) {
                    clientAddressRow.classList.add('print-hide');
                } else if (clientAddressRow) {
                    clientAddressRow.classList.remove('print-hide');
                }
                
                // Ocultar toda la tabla si todos los campos est√°n ocultos
                const allClientHidden = !printConfig.show_client_name && 
                                       !printConfig.show_client_phone && 
                                       !printConfig.show_client_address;
                if (allClientHidden) {
                    clientInfoTablePrint.classList.add('print-hide');
                } else {
                    clientInfoTablePrint.classList.remove('print-hide');
                }
            }
            
            // Tabla de informaci√≥n del gestor
            if (managerInfoTablePrint) {
                const managerNameRow = document.getElementById('managerNameRowTable');
                const managerPhoneRow = document.getElementById('managerPhoneRowTable');
                
                // Aplicar configuraci√≥n de visibilidad
                if (!printConfig.show_manager_name && managerNameRow) {
                    managerNameRow.classList.add('print-hide');
                } else if (managerNameRow) {
                    managerNameRow.classList.remove('print-hide');
                }
                
                if (!printConfig.show_manager_phone && managerPhoneRow) {
                    managerPhoneRow.classList.add('print-hide');
                } else if (managerPhoneRow) {
                    managerPhoneRow.classList.remove('print-hide');
                }
                
                // Ocultar toda la tabla si todos los campos est√°n ocultos
                const allManagerHidden = !printConfig.show_manager_name && 
                                        !printConfig.show_manager_phone;
                if (allManagerHidden) {
                    managerInfoTablePrint.classList.add('print-hide');
                } else {
                    managerInfoTablePrint.classList.remove('print-hide');
                }
            }
        }

        function applySummaryTableVisibility() {
            const summaryTable = document.querySelector('.summary-table');
            if (!summaryTable) return;

            const rows = summaryTable.querySelectorAll('tr');
            
            // Primera fila: Tipo y Monto Solicitado
            if (rows[0]) {
                const cells = rows[0].cells;
                // Tipo de Pr√©stamo
                if (cells[0] && cells[1]) {
                    if (!printConfig.show_loan_type) {
                        cells[0].classList.add('print-hide');
                        cells[1].classList.add('print-hide');
                    } else {
                        cells[0].classList.remove('print-hide');
                        cells[1].classList.remove('print-hide');
                    }
                }
                // Monto Solicitado
                if (cells[2] && cells[3]) {
                    if (!printConfig.show_loan_amount) {
                        cells[2].classList.add('print-hide');
                        cells[3].classList.add('print-hide');
                    } else {
                        cells[2].classList.remove('print-hide');
                        cells[3].classList.remove('print-hide');
                    }
                }
                // Ocultar fila si todas las celdas est√°n ocultas
                if (!printConfig.show_loan_type && !printConfig.show_loan_amount) {
                    rows[0].classList.add('print-hide');
                } else {
                    rows[0].classList.remove('print-hide');
                }
            }

            // Segunda fila: Prima y Monto a Financiar
            if (rows[1]) {
                const cells = rows[1].cells;
                // Prima
                if (cells[0] && cells[1]) {
                    if (!printConfig.show_down_payment) {
                        cells[0].classList.add('print-hide');
                        cells[1].classList.add('print-hide');
                    } else {
                        cells[0].classList.remove('print-hide');
                        cells[1].classList.remove('print-hide');
                    }
                }
                // Monto a Financiar
                if (cells[2] && cells[3]) {
                    if (!printConfig.show_financed_amount) {
                        cells[2].classList.add('print-hide');
                        cells[3].classList.add('print-hide');
                    } else {
                        cells[2].classList.remove('print-hide');
                        cells[3].classList.remove('print-hide');
                    }
                }
                // Ocultar fila si todas las celdas est√°n ocultas
                if (!printConfig.show_down_payment && !printConfig.show_financed_amount) {
                    rows[1].classList.add('print-hide');
                } else {
                    rows[1].classList.remove('print-hide');
                }
            }

            // Tercera fila: Tasa de Inter√©s y Cuota
            if (rows[2]) {
                const cells = rows[2].cells;
                // Tasa de Inter√©s
                if (cells[0] && cells[1]) {
                    if (!printConfig.show_interest_rate) {
                        cells[0].classList.add('print-hide');
                        cells[1].classList.add('print-hide');
                    } else {
                        cells[0].classList.remove('print-hide');
                        cells[1].classList.remove('print-hide');
                    }
                }
                // Cuota Mensual
                if (cells[2] && cells[3]) {
                    if (!printConfig.show_monthly_payment) {
                        cells[2].classList.add('print-hide');
                        cells[3].classList.add('print-hide');
                    } else {
                        cells[2].classList.remove('print-hide');
                        cells[3].classList.remove('print-hide');
                    }
                }
                // Ocultar fila si todas las celdas est√°n ocultas
                if (!printConfig.show_interest_rate && !printConfig.show_monthly_payment) {
                    rows[2].classList.add('print-hide');
                } else {
                    rows[2].classList.remove('print-hide');
                }
            }

            // Cuarta fila: Total de Intereses y Total a Pagar
            if (rows[3]) {
                const cells = rows[3].cells;
                // Total de Intereses
                if (cells[0] && cells[1]) {
                    if (!printConfig.show_total_interest) {
                        cells[0].classList.add('print-hide');
                        cells[1].classList.add('print-hide');
                    } else {
                        cells[0].classList.remove('print-hide');
                        cells[1].classList.remove('print-hide');
                    }
                }
                // Total a Pagar
                if (cells[2] && cells[3]) {
                    if (!printConfig.show_total_amount) {
                        cells[2].classList.add('print-hide');
                        cells[3].classList.add('print-hide');
                    } else {
                        cells[2].classList.remove('print-hide');
                        cells[3].classList.remove('print-hide');
                    }
                }
                // Ocultar fila si todas las celdas est√°n ocultas
                if (!printConfig.show_total_interest && !printConfig.show_total_amount) {
                    rows[3].classList.add('print-hide');
                } else {
                    rows[3].classList.remove('print-hide');
                }
            }
        }

        function updateUI(config) {
            const businessName = config.business_name || defaultConfig.business_name;
            const businessPhone = config.business_phone || defaultConfig.business_phone;
            const businessEmail = config.business_email || defaultConfig.business_email;
            const businessAddress = config.business_address || defaultConfig.business_address;
            const whatsappNumber = config.whatsapp_number || defaultConfig.whatsapp_number;
            const facebookUrl = config.facebook_url || defaultConfig.facebook_url;
            const instagramUrl = config.instagram_url || defaultConfig.instagram_url;
            const twitterUrl = config.twitter_url || defaultConfig.twitter_url;

            document.getElementById('navBusinessName').textContent = businessName;
            document.getElementById('printBusinessName').textContent = businessName;
            document.getElementById('footerPhone').textContent = businessPhone;
            document.getElementById('footerEmail').textContent = businessEmail;
            document.getElementById('footerAddress').textContent = businessAddress;

            // Actualizar encabezado de impresi√≥n
            document.getElementById('printBusinessAddress').textContent = businessAddress;
            
            let contactInfo = [];
            if (businessPhone) contactInfo.push(`üìû ${businessPhone}`);
            if (businessEmail) contactInfo.push(`üìß ${businessEmail}`);
            document.getElementById('printBusinessContact').textContent = contactInfo.join(' | ');

            const whatsappFloat = document.getElementById('whatsappFloat');
            if (whatsappNumber && whatsappNumber.trim() !== '') {
                whatsappFloat.href = `https://wa.me/${whatsappNumber.replace(/[^0-9]/g, '')}`;
                whatsappFloat.classList.remove('hidden');
            } else {
                whatsappFloat.classList.add('hidden');
            }

            const socialLinksContainer = document.getElementById('socialLinks');
            socialLinksContainer.innerHTML = '';

            if (facebookUrl && facebookUrl.trim() !== '') {
                const fbLink = document.createElement('a');
                fbLink.href = facebookUrl;
                fbLink.className = 'social-link';
                fbLink.target = '_blank';
                fbLink.rel = 'noopener noreferrer';
                fbLink.innerHTML = '<span>üìò</span>';
                socialLinksContainer.appendChild(fbLink);
            }

            if (instagramUrl && instagramUrl.trim() !== '') {
                const igLink = document.createElement('a');
                igLink.href = instagramUrl;
                igLink.className = 'social-link';
                igLink.target = '_blank';
                igLink.rel = 'noopener noreferrer';
                igLink.innerHTML = '<span>üì∑</span>';
                socialLinksContainer.appendChild(igLink);
            }

            if (twitterUrl && twitterUrl.trim() !== '') {
                const twLink = document.createElement('a');
                twLink.href = twitterUrl;
                twLink.className = 'social-link';
                twLink.target = '_blank';
                twLink.rel = 'noopener noreferrer';
                twLink.innerHTML = '<span>ÔøΩÔøΩ</span>';
                socialLinksContainer.appendChild(twLink);
            }
        }

        function nextStep(step) {
            if (step === 3 && !validateStep2()) {
                showNotification('Por favor complete todos los campos requeridos del pr√©stamo');
                return;
            }

            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`step${step}`).classList.add('active');

            document.querySelectorAll('.step').forEach(stepEl => {
                const stepNum = parseInt(stepEl.dataset.step);
                stepEl.classList.remove('active');
                if (stepNum < step) {
                    stepEl.classList.add('completed');
                } else if (stepNum === step) {
                    stepEl.classList.add('active');
                } else {
                    stepEl.classList.remove('completed');
                }
            });

            currentStep = step;
        }

        function previousStep(step) {
            nextStep(step);
        }

        function validateStep2() {
            const amount = parseFloat(document.getElementById('loanAmount').value);
            const rate = parseFloat(document.getElementById('interestRate').value);
            const payments = parseInt(document.getElementById('numberOfPayments').value);
            return amount > 0 && rate > 0 && payments > 0;
        }

        function handleLoanTypeChange() {
            const loanType = document.getElementById('loanType').value;
            const monthlyPaymentItem = document.getElementById('monthlyPaymentItem');
            
            if (loanType === 'abierto') {
                monthlyPaymentItem.style.display = 'none';
            } else {
                monthlyPaymentItem.style.display = 'block';
            }
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ff5252;
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                z-index: 1000;
                animation: slideIn 0.3s;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function calculateLoan() {
            if (!validateStep2()) {
                showNotification('Por favor complete todos los campos requeridos del pr√©stamo');
                return;
            }

            const loanType = document.getElementById('loanType').value;
            const interestType = document.getElementById('interestType').value;
            const rateType = document.getElementById('rateType').value;
            const loanAmount = parseFloat(document.getElementById('loanAmount').value);
            const interestRate = parseFloat(document.getElementById('interestRate').value);
            const downPayment = parseFloat(document.getElementById('downPayment').value) || 0;
            const numberOfPayments = parseInt(document.getElementById('numberOfPayments').value);

            const financedAmount = loanAmount - downPayment;

            let paymentSchedule = [];
            let totalInterest = 0;
            let totalAmount = 0;
            let monthlyPayment = 0;

            if (loanType === 'amortizado') {
                const result = calculateAmortized(financedAmount, interestRate, numberOfPayments, rateType, interestType);
                paymentSchedule = result.schedule;
                totalInterest = result.totalInterest;
                totalAmount = result.totalAmount;
                monthlyPayment = result.monthlyPayment;
            } else {
                const result = calculateOpen(financedAmount, interestRate, numberOfPayments, rateType, interestType);
                paymentSchedule = result.schedule;
                totalInterest = result.totalInterest;
                totalAmount = result.totalAmount;
            }

            displayResults(loanType, loanAmount, downPayment, financedAmount, interestRate, rateType, interestType, totalInterest, totalAmount, monthlyPayment, paymentSchedule);

            document.getElementById('resultSection').classList.add('active');
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }

        function calculateAmortized(principal, rate, payments, rateType, interestType) {
            // Si la tasa es anual, se divide entre 12 para obtener la tasa mensual
            let periodRate = rate / 100;
            if (rateType === 'anual') {
                periodRate = periodRate / 12;
            }

            let monthlyPayment;
            let totalInterest;
            let schedule = [];

            // INTER√âS SIMPLE: Cuando el usuario selecciona "simple"
            if (interestType === 'simple') {
                // Inter√©s Simple: Capital √ó Tasa √ó Tiempo
                // Total a pagar = Capital + Inter√©s Total
                // Cuota = Total a pagar / Cantidad de pagos
                totalInterest = principal * periodRate * payments;
                const totalAmount = principal + totalInterest;
                monthlyPayment = totalAmount / payments;
                
                let balance = principal;
                const principalPayment = principal / payments;
                const interestPayment = totalInterest / payments;

                for (let i = 1; i <= payments; i++) {
                    const startBalance = balance;
                    balance -= principalPayment;

                    schedule.push({
                        number: i,
                        date: getPaymentDate(i, rateType),
                        startBalance: startBalance,
                        payment: monthlyPayment,
                        principal: principalPayment,
                        interest: interestPayment,
                        endBalance: Math.max(0, balance)
                    });
                }
            } 
            // INTER√âS REDESCONTADO: Cuando el usuario selecciona "redescontado"
            else {
                // Inter√©s Redescontado: Cada pago incluye inter√©s sobre saldo restante + amortizaci√≥n de capital
                // F√≥rmula de cuota fija: P = (Principal * r) / (1 - (1 + r)^-n)
                if (periodRate === 0) {
                    monthlyPayment = principal / payments;
                } else {
                    monthlyPayment = (principal * periodRate) / (1 - Math.pow(1 + periodRate, -payments));
                }
                
                let balance = principal;
                totalInterest = 0;

                for (let i = 1; i <= payments; i++) {
                    const interestPayment = balance * periodRate;
                    const principalPayment = monthlyPayment - interestPayment;
                    const startBalance = balance;
                    balance -= principalPayment;
                    totalInterest += interestPayment;

                    schedule.push({
                        number: i,
                        date: getPaymentDate(i, rateType),
                        startBalance: startBalance,
                        payment: monthlyPayment,
                        principal: principalPayment,
                        interest: interestPayment,
                        endBalance: Math.max(0, balance)
                    });
                }
            }

            const totalAmount = principal + totalInterest;

            return { schedule, totalInterest, totalAmount, monthlyPayment };
        }

        function calculateOpen(principal, rate, payments, rateType, interestType) {
            // Si la tasa es anual, se divide entre 12 para obtener la tasa mensual
            let periodRate = rate / 100;
            if (rateType === 'anual') {
                periodRate = periodRate / 12;
            }

            let schedule = [];
            let totalInterest = 0;
            let balance = principal;

            // INTER√âS SIMPLE: Cuando el usuario selecciona "simple"
            if (interestType === 'simple') {
                // Inter√©s Simple: Capital √ó Tasa √ó Tiempo
                // Se paga el inter√©s prorrateado en cada per√≠odo y el capital al final
                totalInterest = principal * periodRate * payments;
                const interestPerPayment = totalInterest / payments;

                for (let i = 1; i <= payments; i++) {
                    // Si es el ÔøΩÔøΩltimo pago, se incluye el principal
                    if (i === payments) {
                        schedule.push({
                            number: i,
                            date: getPaymentDate(i, rateType),
                            startBalance: principal,
                            payment: interestPerPayment + principal,
                            principal: principal,
                            interest: interestPerPayment,
                            endBalance: 0
                        });
                    } else {
                        schedule.push({
                            number: i,
                            date: getPaymentDate(i, rateType),
                            startBalance: principal,
                            payment: interestPerPayment,
                            principal: 0,
                            interest: interestPerPayment,
                            endBalance: principal
                        });
                    }
                }
            } 
            // INTER√âS REDESCONTADO: Cuando el usuario selecciona "redescontado"
            else {
                // Pr√©stamo Abierto con Inter√©s Redescontado: Solo se pagan intereses en cada per√≠odo
                // El capital se paga completo al final
                for (let i = 1; i <= payments; i++) {
                    const interestPayment = principal * periodRate; // Inter√©s siempre sobre el principal completo
                    const startBalance = principal;
                    totalInterest += interestPayment;

                    // Si es el √∫ltimo pago, se incluye el principal
                    if (i === payments) {
                        schedule.push({
                            number: i,
                            date: getPaymentDate(i, rateType),
                            startBalance: startBalance,
                            payment: interestPayment + principal,
                            principal: principal,
                            interest: interestPayment,
                            endBalance: 0
                        });
                    } else {
                        schedule.push({
                            number: i,
                            date: getPaymentDate(i, rateType),
                            startBalance: startBalance,
                            payment: interestPayment,
                            principal: 0,
                            interest: interestPayment,
                            endBalance: principal
                        });
                    }
                }
            }

            const totalAmount = principal + totalInterest;

            return { schedule, totalInterest, totalAmount };
        }

        function getPaymentDate(paymentNumber, rateType) {
            const today = new Date();
            let date = new Date(today);

            switch(rateType) {
                case 'diaria':
                    date.setDate(today.getDate() + paymentNumber);
                    break;
                case 'semanal':
                    date.setDate(today.getDate() + (paymentNumber * 7));
                    break;
                case 'quincenal':
                    date.setDate(today.getDate() + (paymentNumber * 15));
                    break;
                case 'mensual':
                case 'anual':
                    // Tanto mensual como anual usan pagos mensuales
                    date.setMonth(today.getMonth() + paymentNumber);
                    break;
            }

            return date.toLocaleDateString('es-HN', { year: 'numeric', month: '2-digit', day: '2-digit' });
        }

        function displayResults(loanType, loanAmount, downPayment, financedAmount, interestRate, rateType, interestType, totalInterest, totalAmount, monthlyPayment, paymentSchedule) {
            const clientName = document.getElementById('clientName').value.trim();
            const clientPhone = document.getElementById('clientPhone').value.trim();
            const clientAddress = document.getElementById('clientAddress').value.trim();
            const managerName = document.getElementById('managerName').value.trim();
            const managerPhone = document.getElementById('managerPhone').value.trim();

            // Mostrar u ocultar informaci√≥n del cliente
            const hasClientInfo = clientName || clientPhone || clientAddress;
            const clientInfoBox = document.getElementById('clientInfoBox');
            
            if (hasClientInfo) {
                clientInfoBox.style.display = 'block';
                
                // Mostrar/ocultar cada campo individualmente
                document.getElementById('clientNameRow').style.display = clientName ? 'flex' : 'none';
                document.getElementById('clientPhoneRow').style.display = clientPhone ? 'flex' : 'none';
                document.getElementById('clientAddressRow').style.display = clientAddress ? 'flex' : 'none';
                
                document.getElementById('resultClientName').textContent = clientName;
                document.getElementById('resultClientPhone').textContent = clientPhone;
                document.getElementById('resultClientAddress').textContent = clientAddress;
                
                document.getElementById('resultClientNameTable').textContent = clientName;
                document.getElementById('resultClientPhoneTable').textContent = clientPhone;
                document.getElementById('resultClientAddressTable').textContent = clientAddress;
            } else {
                clientInfoBox.style.display = 'none';
            }

            // Mostrar u ocultar informaci√≥n del gestor
            const hasManagerInfo = managerName || managerPhone;
            const managerInfoBox = document.getElementById('managerInfoBox');
            
            if (hasManagerInfo) {
                managerInfoBox.style.display = 'block';
                
                // Mostrar/ocultar cada campo individualmente
                document.getElementById('managerNameRow').style.display = managerName ? 'flex' : 'none';
                document.getElementById('managerPhoneRow').style.display = managerPhone ? 'flex' : 'none';
                
                document.getElementById('resultManagerName').textContent = managerName;
                document.getElementById('resultManagerPhone').textContent = managerPhone;
                
                document.getElementById('resultManagerNameTable').textContent = managerName;
                document.getElementById('resultManagerPhoneTable').textContent = managerPhone;
            } else {
                managerInfoBox.style.display = 'none';
            }

            // Ocultar toda la secci√≥n info-section si no hay datos de cliente ni gestor
            const infoSection = document.getElementById('infoSection');
            const clientInfoTablePrint = document.getElementById('clientInfoTablePrint');
            const managerInfoTablePrint = document.getElementById('managerInfoTablePrint');
            
            if (!hasClientInfo && !hasManagerInfo) {
                infoSection.style.display = 'none';
                if (clientInfoTablePrint) {
                    clientInfoTablePrint.classList.add('print-hide');
                }
                if (managerInfoTablePrint) {
                    managerInfoTablePrint.classList.add('print-hide');
                }
            } else {
                infoSection.style.display = 'grid';
                
                // Mostrar u ocultar tabla de cliente seg√∫n tenga datos
                if (clientInfoTablePrint) {
                    if (hasClientInfo) {
                        clientInfoTablePrint.classList.remove('print-hide');
                        // Ocultar filas individuales seg√∫n datos Y seg√∫n configuraci√≥n
                        const clientNameRowTable = document.getElementById('clientNameRowTable');
                        const clientPhoneRowTable = document.getElementById('clientPhoneRowTable');
                        const clientAddressRowTable = document.getElementById('clientAddressRowTable');
                        
                        if (clientName && printConfig.show_client_name) {
                            clientNameRowTable.style.display = 'table-row';
                            clientNameRowTable.classList.remove('print-hide');
                        } else {
                            clientNameRowTable.style.display = 'none';
                            clientNameRowTable.classList.add('print-hide');
                        }
                        
                        if (clientPhone && printConfig.show_client_phone) {
                            clientPhoneRowTable.style.display = 'table-row';
                            clientPhoneRowTable.classList.remove('print-hide');
                        } else {
                            clientPhoneRowTable.style.display = 'none';
                            clientPhoneRowTable.classList.add('print-hide');
                        }
                        
                        if (clientAddress && printConfig.show_client_address) {
                            clientAddressRowTable.style.display = 'table-row';
                            clientAddressRowTable.classList.remove('print-hide');
                        } else {
                            clientAddressRowTable.style.display = 'none';
                            clientAddressRowTable.classList.add('print-hide');
                        }
                        
                        // Verificar si todas las filas est√°n ocultas
                        const allClientRowsHidden = (!clientName || !printConfig.show_client_name) &&
                                                   (!clientPhone || !printConfig.show_client_phone) &&
                                                   (!clientAddress || !printConfig.show_client_address);
                        if (allClientRowsHidden) {
                            clientInfoTablePrint.classList.add('print-hide');
                        }
                    } else {
                        clientInfoTablePrint.classList.add('print-hide');
                    }
                }
                
                // Mostrar u ocultar tabla de gestor seg√∫n tenga datos
                if (managerInfoTablePrint) {
                    if (hasManagerInfo) {
                        managerInfoTablePrint.classList.remove('print-hide');
                        // Ocultar filas individuales seg√∫n datos Y seg√∫n configuraci√≥n
                        const managerNameRowTable = document.getElementById('managerNameRowTable');
                        const managerPhoneRowTable = document.getElementById('managerPhoneRowTable');
                        
                        if (managerName && printConfig.show_manager_name) {
                            managerNameRowTable.style.display = 'table-row';
                            managerNameRowTable.classList.remove('print-hide');
                        } else {
                            managerNameRowTable.style.display = 'none';
                            managerNameRowTable.classList.add('print-hide');
                        }
                        
                        if (managerPhone && printConfig.show_manager_phone) {
                            managerPhoneRowTable.style.display = 'table-row';
                            managerPhoneRowTable.classList.remove('print-hide');
                        } else {
                            managerPhoneRowTable.style.display = 'none';
                            managerPhoneRowTable.classList.add('print-hide');
                        }
                        
                        // Verificar si todas las filas est√°n ocultas
                        const allManagerRowsHidden = (!managerName || !printConfig.show_manager_name) &&
                                                     (!managerPhone || !printConfig.show_manager_phone);
                        if (allManagerRowsHidden) {
                            managerInfoTablePrint.classList.add('print-hide');
                        }
                    } else {
                        managerInfoTablePrint.classList.add('print-hide');
                    }
                }
            }
            
            // Tambi√©n ocultar el encabezado si no hay informaci√≥n
            const summaryHeading = document.querySelector('#resultSection h2');
            if (summaryHeading) {
                if (!hasClientInfo && !hasManagerInfo) {
                    // Mantener el encabezado visible pero sin margen extra
                    summaryHeading.style.marginBottom = '1.5rem';
                } else {
                    summaryHeading.style.marginBottom = '1.5rem';
                }
            }

            const loanTypeText = loanType === 'amortizado' ? 'Amortizado' : 'Abierto';
            const rateTypeText = {
                'diaria': 'Diaria',
                'semanal': 'Semanal',
                'quincenal': 'Quincenal',
                'mensual': 'Mensual',
                'anual': 'Anual'
            }[rateType];
            const interestTypeText = interestType === 'simple' ? 'Simple' : 'Redescontado';

            const fullLoanType = `${loanTypeText} - ${interestTypeText}`;
            const fullInterestRate = `${interestRate}% ${rateTypeText}`;

            document.getElementById('resultLoanType').textContent = fullLoanType;
            document.getElementById('resultLoanAmount').textContent = formatCurrency(loanAmount);
            document.getElementById('resultDownPayment').textContent = formatCurrency(downPayment);
            document.getElementById('resultFinancedAmount').textContent = formatCurrency(financedAmount);
            document.getElementById('resultInterestRate').textContent = fullInterestRate;
            document.getElementById('resultTotalInterest').textContent = formatCurrency(totalInterest);
            document.getElementById('resultTotalAmount').textContent = formatCurrency(totalAmount);

            document.getElementById('resultLoanTypeTable').textContent = fullLoanType;
            document.getElementById('resultLoanAmountTable').textContent = formatCurrency(loanAmount);
            document.getElementById('resultDownPaymentTable').textContent = formatCurrency(downPayment);
            document.getElementById('resultFinancedAmountTable').textContent = formatCurrency(financedAmount);
            document.getElementById('resultInterestRateTable').textContent = fullInterestRate;
            document.getElementById('resultTotalInterestTable').textContent = formatCurrency(totalInterest);
            document.getElementById('resultTotalAmountTable').textContent = formatCurrency(totalAmount);
            
            if (loanType === 'amortizado') {
                document.getElementById('resultMonthlyPayment').textContent = formatCurrency(monthlyPayment);
                document.getElementById('resultMonthlyPaymentTable').textContent = formatCurrency(monthlyPayment);
                document.getElementById('monthlyPaymentLabelTable').style.display = '';
                document.getElementById('resultMonthlyPaymentTable').style.display = '';
            } else {
                document.getElementById('monthlyPaymentLabelTable').style.display = 'none';
                document.getElementById('resultMonthlyPaymentTable').style.display = 'none';
            }

            const tbody = document.getElementById('paymentTableBody');
            tbody.innerHTML = '';

            paymentSchedule.forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${payment.number}</td>
                    <td>${payment.date}</td>
                    <td>${formatCurrency(payment.startBalance)}</td>
                    <td>${formatCurrency(payment.payment)}</td>
                    <td>${formatCurrency(payment.principal)}</td>
                    <td>${formatCurrency(payment.interest)}</td>
                    <td>${formatCurrency(payment.endBalance)}</td>
                `;
                tbody.appendChild(row);
            });

            const printDate = new Date().toLocaleDateString('es-HN', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('printDate').textContent = `Generado: ${printDate}`;

            document.getElementById('signatureName').textContent = clientName;

            document.getElementById('printFloat').classList.add('active');

            // Aplicar configuraci√≥n de visibilidad
            applyPrintConfig();
        }

        function formatCurrency(amount) {
            return `L ${amount.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,')}`;
        }

        function resetCalculator() {
            document.getElementById('clientName').value = '';
            document.getElementById('clientPhone').value = '';
            document.getElementById('clientAddress').value = '';
            document.getElementById('loanAmount').value = '';
            document.getElementById('interestRate').value = '';
            document.getElementById('downPayment').value = '0';
            document.getElementById('numberOfPayments').value = '';
            document.getElementById('managerName').value = '';
            document.getElementById('managerPhone').value = '';

            document.getElementById('resultSection').classList.remove('active');
            document.getElementById('printFloat').classList.remove('active');
            
            nextStep(1);

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig: defaultConfig,
                onConfigChange: async (config) => {
                    updateUI(config);
                },
                mapToCapabilities: (config) => ({
                    recolorables: [],
                    borderables: [],
                    fontEditable: undefined,
                    fontSizeable: undefined
                }),
                mapToEditPanelValues: (config) => new Map([
                    ["business_name", config.business_name || defaultConfig.business_name],
                    ["business_phone", config.business_phone || defaultConfig.business_phone],
                    ["business_email", config.business_email || defaultConfig.business_email],
                    ["business_address", config.business_address || defaultConfig.business_address],
                    ["whatsapp_number", config.whatsapp_number || defaultConfig.whatsapp_number],
                    ["facebook_url", config.facebook_url || defaultConfig.facebook_url],
                    ["instagram_url", config.instagram_url || defaultConfig.instagram_url],
                    ["twitter_url", config.twitter_url || defaultConfig.twitter_url]
                ])
            });
        }

        updateUI(defaultConfig);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a0e3033e46e31c5',t:'MTc2MzUzOTM3Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
